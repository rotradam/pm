# Data Directory Structure

**Last Updated**: 2025-11-16  
**Status**: ‚úÖ Clean and Production-Ready

## Directory Layout

```
data/
‚îú‚îÄ‚îÄ README.md                              # This file
‚îú‚îÄ‚îÄ isin_ticker_mapping_verified.json      # Verified ISIN‚Üíticker mappings (72 ISINs)
‚îú‚îÄ‚îÄ prices/                                # Individual ticker price caches (69 files)
‚îÇ   ‚îú‚îÄ‚îÄ IWDA.AS_2015-01-01_2025-11-16.parquet
‚îÇ   ‚îú‚îÄ‚îÄ VWRA.L_2015-01-01_2025-11-16.parquet
‚îÇ   ‚îî‚îÄ‚îÄ ... (67 more)
‚îî‚îÄ‚îÄ processed/                             # Processed/combined datasets
    ‚îú‚îÄ‚îÄ prices_2015-01-01_2025-11-16.parquet   # Main price matrix (2,811 days √ó 69 assets)
    ‚îî‚îÄ‚îÄ ticker_mapping.csv                      # ISIN‚Üíticker reference with sectors
```

## File Descriptions

### `isin_ticker_mapping_verified.json`

**Purpose**: Verified ISIN to Yahoo Finance ticker mappings

**Format**: JSON dictionary `{ISIN: ticker}`

**Example**:
```json
{
  "IE00B4L5Y983": "IWDA.AS",
  "IE00BK5BQT80": "VWRA.L",
  "US37954Y8553": "LIT"
}
```

**Source**: Generated by `scripts/resolve_isins_openfigi.py` using OpenFIGI API

**Coverage**: 72 unique ISINs (85% of universe)

### `prices/` Directory

**Purpose**: Individual ticker price caches for fast lookups

**Naming**: `{TICKER}_{START_DATE}_{END_DATE}.parquet`

**Content**: OHLC + Adj Close data per ticker

**Size**: ~6.9 MB total (69 files)

**Date Range**: 2015-01-01 to 2025-11-16 (~11 years, 2,811 trading days)

**Usage**: 
- Automatically created by `backend/data/prices.py`
- Used for incremental updates (avoid re-downloading)
- Can be deleted and regenerated anytime

### `processed/prices_2015-01-01_2025-11-16.parquet`

**Purpose**: Combined price matrix for backtesting

**Format**: Pandas DataFrame
- Index: DatetimeIndex (trading dates)
- Columns: Tickers (69 assets)
- Values: Adjusted Close prices (or Close for UCITS ETFs)

**Size**: 1.1 MB

**Shape**: 2,811 days √ó 69 assets = 193,959 data points

**Completeness**: 100% (0 missing values)

**Usage**: Load this file directly for backtesting strategies

**Example**:
```python
import pandas as pd
prices = pd.read_parquet("data/processed/prices_2015-01-01_2025-11-16.parquet")
print(prices.head())
```

### `processed/ticker_mapping.csv`

**Purpose**: Human-readable reference for ISIN‚Üíticker with metadata

**Columns**:
- `isin`: ISIN code
- `name`: Full ETF name
- `ticker`: Yahoo Finance ticker
- `sector`: Asset class / sector

**Size**: 5.4 KB (69 rows)

**Usage**: Documentation and reference for backtest results

## Data Maintenance

### To Refresh All Data

```bash
# Download latest data (updates last ~30 days automatically)
python scripts/download_data.py
```

### To Force Full Re-download

```bash
# Clear cache and re-download everything
rm -rf data/prices/*.parquet data/processed/prices_*.parquet
python scripts/download_data.py --force
```

### To Add New Mappings

1. Update `data/isin_ticker_mapping_verified.json` manually or
2. Run `scripts/resolve_isins_openfigi.py` for bulk resolution

### To Clean Up Old Data

```bash
# Remove files older than 30 days (optional)
find data/prices -name "*.parquet" -mtime +30 -delete
```

## Data Quality

| Metric | Value |
|--------|-------|
| Date Range | 2015-01-02 to 2025-11-14 |
| Trading Days | 2,811 |
| Assets | 69 |
| Data Points | 193,959 |
| Missing Values | 0 (0.00%) |
| Completeness | 100% ‚úÖ |
| Failed Tickers | 3 (delisted) |

### Failed Downloads (Delisted)

These tickers are in the mapping but have no data:

1. `SXXPIEX.DE` - iShares STOXX Europe 600 (delisted/renamed)
2. `XBLC.DE` - Xtrackers EUR Corporate Bond (delisted/renamed)
3. `DJCOMEX.DE` - iShares Diversified Commodity (delisted/renamed)

**Action**: Remove these ISINs from universe or find replacement tickers

## Storage Guidelines

### What to Keep

‚úÖ Keep ALL files in this directory structure
‚úÖ Commit `isin_ticker_mapping_verified.json` to git
‚úÖ Commit `processed/ticker_mapping.csv` to git (reference)
‚ùå Do NOT commit `prices/*.parquet` (too large, regenerable)
‚ùå Do NOT commit `processed/prices_*.parquet` (too large, regenerable)

### `.gitignore` Settings

```gitignore
# Price data (regenerable)
data/prices/
data/processed/prices_*.parquet

# Keep mappings and docs
!data/isin_ticker_mapping_verified.json
!data/processed/ticker_mapping.csv
!data/README.md
```

## Disk Usage

```
Total: ~7.9 MB
‚îú‚îÄ‚îÄ prices/           ~6.9 MB (69 files)
‚îú‚îÄ‚îÄ processed/        ~1.1 MB (main matrix)
‚îî‚îÄ‚îÄ mappings          ~7.5 KB (JSON + CSV)
```

**Note**: Very reasonable for ~11 years of daily data across 69 instruments!

## Troubleshooting

### Missing Ticker Data

**Symptom**: Warning "No data returned for {TICKER}"

**Causes**:
1. Ticker delisted/renamed
2. Wrong exchange suffix
3. Yahoo Finance doesn't have data for that exchange

**Solution**:
1. Check ticker on finance.yahoo.com
2. Update `isin_ticker_mapping_verified.json` with correct ticker
3. Re-run download script

### Incomplete Date Range

**Symptom**: Price matrix has fewer days than expected

**Cause**: Some tickers have shorter history than others

**Solution**: This is normal - matrix uses intersection of all date ranges

### Out of Date Prices

**Symptom**: Latest prices are from several days ago

**Cause**: Yahoo Finance updates with 1-2 day delay

**Solution**: Normal behavior, just re-run download script for latest data

## Performance Notes

- Loading full price matrix: ~100ms
- Loading individual ticker cache: ~10ms
- Full re-download (69 tickers): ~30 seconds
- Incremental update (last 30 days): ~15 seconds

## Next Steps

With this clean data structure, you can now:

1. ‚úÖ Implement baseline strategies (EW, BH, CRP)
2. ‚úÖ Build cost model & rebalancing engine
3. ‚úÖ Create backtest runner
4. ‚úÖ Build dashboard for results visualization

All data is production-ready! üéØ
